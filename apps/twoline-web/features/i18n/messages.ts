import type { AppLocale } from "./types";

type MessageMap = Record<string, string>;
type MessageParams = Record<string, string | number>;

const MESSAGES: Record<AppLocale, MessageMap> = {
  ko: {
    "common.locale": "언어",
    "common.lang.ko": "한국어",
    "common.lang.en": "영어",
    "common.loading": "로딩 중...",
    "common.backToTransactions": "거래 화면으로 돌아가기",
    "common.refresh": "새로고침",
    "common.none": "없음",
    "nav.dashboard": "대시보드",
    "nav.csvStudio": "CSV 스튜디오",
    "nav.recurring": "반복 등록",
    "nav.quickAdd": "퀵 입력",

    "ledger.title.main": "TwoLine 거래 입력",
    "ledger.title.form": "템플릿 기반 입력",
    "ledger.title.drafts": "임시 저장(DRAFT)",
    "ledger.title.posted": "확정 거래(POSTED)",
    "ledger.label.template": "템플릿",
    "ledger.label.occurredAt": "거래일",
    "ledger.label.amount": "금액 (KRW)",
    "ledger.label.memo": "메모",
    "ledger.button.saveDraft": "임시 저장",
    "ledger.button.saveAndPost": "저장 후 확정",
    "ledger.button.post": "확정(POST)",
    "ledger.status.emptyDrafts": "임시 저장된 거래가 없습니다.",
    "ledger.status.emptyPosted": "확정된 거래가 없습니다.",
    "ledger.success.draftSaved": "임시 저장이 완료되었습니다.",
    "ledger.success.posted": "거래가 확정되었습니다.",
    "ledger.success.quickAddApplied": "퀵 입력 결과를 폼에 반영했습니다.",
    "ledger.error.invalidAmount": "금액은 1 이상 숫자로 입력해 주세요.",
    "ledger.error.invalidDate": "날짜 형식을 확인해 주세요. 예: 2026-02-08",
    "ledger.error.templateNotFound": "템플릿을 찾을 수 없습니다. 다시 선택해 주세요.",
    "ledger.error.unbalanced": "차변/대변 합계가 맞지 않습니다.",
    "ledger.error.unknown": "요청 처리 중 오류가 발생했습니다.",
    "ledger.meta.kind.ORIGINAL": "원본",
    "ledger.meta.kind.CORRECTION": "수정",
    "ledger.meta.kind.REVERSAL": "취소",

    "quickAdd.title": "퀵 입력",
    "quickAdd.button.close": "닫기",
    "quickAdd.button.paste": "붙여넣기",
    "quickAdd.button.parse": "분석",
    "quickAdd.button.apply": "폼에 적용",
    "quickAdd.notice.manualTrigger":
      "분석은 버튼 클릭 시에만 실행됩니다. 앱 진입 시 자동 클립보드 읽기는 하지 않습니다.",
    "quickAdd.notice.pasteLoaded": "클립보드 내용을 불러왔습니다. 분석 버튼을 눌러주세요.",
    "quickAdd.notice.pasteFailed": "클립보드 접근에 실패했습니다. 직접 붙여넣어 주세요.",
    "quickAdd.notice.partial": "일부 필드를 자동으로 채우지 못했습니다. 안내를 확인해 주세요.",
    "quickAdd.notice.ready": "분석 완료. 적용 버튼으로 거래 입력 폼에 반영할 수 있습니다.",
    "quickAdd.label.inputText": "붙여넣을 원문",
    "quickAdd.placeholder.inputText": "예: 2026-02-08 스타벅스 12,900원 카드승인",
    "quickAdd.label.confidence": "신뢰도",
    "quickAdd.label.occurredAt": "거래일",
    "quickAdd.label.amount": "금액",
    "quickAdd.label.memo": "메모",
    "quickAdd.label.direction": "입출금 방향",
    "quickAdd.label.reasonCodes": "사유 코드",

    "csv.title": "CSV 스튜디오",
    "csv.title.export": "내보내기",
    "csv.title.importPipeline": "가져오기 파이프라인",
    "csv.title.auditEvents": "감사 이벤트",
    "csv.title.transactionImport": "간편 거래 CSV 가져오기",
    "csv.button.loadCanonical": "Canonical 불러오기",
    "csv.button.loadFlatBom": "Flat 불러오기(BOM)",
    "csv.button.useCanonicalAsImport": "Canonical을 가져오기 입력값으로 사용",
    "csv.button.preview": "사전 검증(Preview)",
    "csv.button.commit": "커밋",
    "csv.button.refreshAudit": "감사 이벤트 새로고침",
    "csv.button.transactionPreview": "간편 CSV 미리보기",
    "csv.button.applyTransactionImport": "간편 CSV 반영",
    "csv.label.canonicalFiles": "Canonical 파일(JSON)",
    "csv.label.flatCsv": "Flat CSV",
    "csv.label.importPayload": "가져오기 입력값(JSON 배열)",
    "csv.label.forceMode": "강제 모드 (오류가 있어도 커밋 허용)",
    "csv.label.transactionSchema": "스키마: 계정명, 날짜, 내용, 금액, 카테고리(nullable)",
    "csv.label.transactionCsvInput": "간편 CSV 입력값",
    "csv.label.applyPolicy": "반영 정책",
    "csv.label.validRows": "유효 행 수",
    "csv.label.errorRows": "오류 행 수",
    "csv.label.totalIncome": "수입 합계",
    "csv.label.totalExpense": "지출 합계",
    "csv.label.net": "순손익",
    "csv.label.session": "세션",
    "csv.label.status": "상태",
    "csv.label.rows": "행 수",
    "csv.label.errors": "오류 목록",
    "csv.policy.failOnAnyError": "전체 실패 (오류가 있으면 반영 차단)",
    "csv.policy.allowPartial": "부분 반영 (유효 행만 반영)",
    "csv.status.none": "없음",
    "csv.status.noPreview": "사전 검증을 실행하면 결과가 표시됩니다.",
    "csv.status.noAudit": "감사 이벤트가 아직 없습니다.",
    "csv.status.noTransactionPreview": "간편 CSV 미리보기를 실행하면 결과가 표시됩니다.",
    "csv.notice.exportCanonicalLoaded": "Canonical 내보내기를 불러왔습니다.",
    "csv.notice.exportFlatLoaded": "Flat 내보내기를 불러왔습니다.",
    "csv.notice.canonicalCopied": "Canonical 결과를 가져오기 입력값으로 복사했습니다.",
    "csv.notice.previewCompleted": "사전 검증이 완료되었습니다.",
    "csv.notice.commitCompleted": "가져오기 커밋이 완료되었습니다.",
    "csv.notice.auditLoaded": "감사 이벤트를 불러왔습니다.",
    "csv.notice.transactionPreviewCompleted": "간편 CSV 미리보기가 완료되었습니다.",
    "csv.notice.transactionApplyBlocked": "오류가 있어 현재 정책으로는 반영할 수 없습니다.",
    "csv.notice.transactionApplied": "반영 완료: {count}건, 수입 {income} KRW, 지출 {expense} KRW",
    "csv.notice.invalidImportPayload": "가져오기 입력값은 JSON 배열이어야 합니다.",
    "csv.error.exportCanonicalFailed": "Canonical 내보내기에 실패했습니다: {code}",
    "csv.error.exportFlatFailed": "Flat 내보내기에 실패했습니다: {code}",
    "csv.error.previewFailed": "사전 검증 실패: {code}",
    "csv.error.commitFailed": "커밋 실패: {code}",
    "csv.error.auditFailed": "감사 이벤트 조회에 실패했습니다.",
    "csv.error.previewFirst": "먼저 사전 검증을 실행해 세션 ID를 만들어 주세요.",
    "csv.error.message.error.csv.previewFailed": "CSV 사전 검증에 실패했습니다.",
    "csv.error.message.error.csv.commitFailed": "CSV 커밋에 실패했습니다.",
    "csv.error.message.error.csv.duplicateImport": "중복 가져오기입니다. 필요 시 강제 모드를 사용하세요.",
    "csv.error.message.errors.csv.invalidDate": "날짜 형식이 잘못되었습니다.",
    "csv.error.message.errors.csv.invalidAmount": "금액 형식이 잘못되었습니다.",
    "csv.error.message.errors.csv.missingRequired": "필수 항목이 누락되었습니다.",
    "csv.error.message.errors.csv.unbalancedPostings": "차변/대변 합계가 맞지 않습니다.",
    "csv.error.message.errors.csv.currencyMismatch": "통화가 기준 통화와 다릅니다.",
    "csv.error.message.errors.csv.lockedTransaction": "잠긴 거래는 가져올 수 없습니다.",

    "recurring.title": "반복 거래 DRAFT 생성",
    "recurring.title.createRule": "규칙 만들기",
    "recurring.title.run": "실행 날짜 기준 생성",
    "recurring.title.rules": "규칙 목록",
    "recurring.title.generated": "생성된 DRAFT 인스턴스",
    "recurring.label.template": "템플릿",
    "recurring.label.amount": "금액 (KRW)",
    "recurring.label.dayOfMonth": "매월 일자",
    "recurring.label.startDate": "시작일",
    "recurring.label.memo": "메모",
    "recurring.label.targetDate": "기준일",
    "recurring.button.createRule": "규칙 생성",
    "recurring.button.generateDrafts": "DRAFT 생성",
    "recurring.notice.loadFailed": "반복 규칙 목록을 불러오지 못했습니다.",
    "recurring.notice.ruleCreated": "반복 규칙이 생성되었습니다.",
    "recurring.notice.runFailed": "반복 실행에 실패했습니다: {code}",
    "recurring.notice.generated": "생성된 DRAFT 수: {count}",
    "recurring.status.noRules": "등록된 반복 규칙이 없습니다.",
    "recurring.status.noGenerated": "생성 실행 후 인스턴스가 표시됩니다.",

    "dashboard.title": "대시보드",
    "dashboard.title.monthlySpendTrend": "월별 지출 추이",
    "dashboard.title.categoryBreakdown": "카테고리 비중",
    "dashboard.title.recurringUpcoming": "예정된 반복 DRAFT",
    "dashboard.title.inputHealth": "입력 건강 지표",
    "dashboard.card.income": "수입",
    "dashboard.card.expense": "지출",
    "dashboard.card.net": "순이익",
    "dashboard.label.daysTracked": "최근 30일 입력일",
    "dashboard.label.quickAddRatio": "퀵 입력 비율",
    "dashboard.label.csvImportSuccess": "CSV 가져오기 성공률",
    "dashboard.notice.loading": "대시보드를 불러오는 중입니다...",
    "dashboard.notice.updated": "대시보드가 갱신되었습니다.",
    "dashboard.notice.loadFailed": "대시보드를 불러오지 못했습니다: {code}",
    "dashboard.status.noExpense": "지출 데이터가 아직 없습니다.",
    "dashboard.status.noRecurring": "반복 규칙이 아직 없습니다."
  },
  en: {
    "common.locale": "Locale",
    "common.lang.ko": "Korean",
    "common.lang.en": "English",
    "common.loading": "Loading...",
    "common.backToTransactions": "Back to Transactions",
    "common.refresh": "Refresh",
    "common.none": "None",
    "nav.dashboard": "Dashboard",
    "nav.csvStudio": "CSV Studio",
    "nav.recurring": "Recurring",
    "nav.quickAdd": "Quick Add",

    "ledger.title.main": "TwoLine Transaction Input",
    "ledger.title.form": "Template-driven Form",
    "ledger.title.drafts": "Draft Transactions",
    "ledger.title.posted": "Posted Transactions",
    "ledger.label.template": "Template",
    "ledger.label.occurredAt": "Occurred at",
    "ledger.label.amount": "Amount (KRW)",
    "ledger.label.memo": "Memo",
    "ledger.button.saveDraft": "Save Draft",
    "ledger.button.saveAndPost": "Save and Post",
    "ledger.button.post": "Post",
    "ledger.status.emptyDrafts": "No saved drafts yet.",
    "ledger.status.emptyPosted": "No posted transactions yet.",
    "ledger.success.draftSaved": "Draft saved.",
    "ledger.success.posted": "Transaction posted.",
    "ledger.success.quickAddApplied": "Quick Add result has been applied to the form.",
    "ledger.error.invalidAmount": "Amount must be an integer greater than 0.",
    "ledger.error.invalidDate": "Check date format. Example: 2026-02-08",
    "ledger.error.templateNotFound": "Template was not found. Please select again.",
    "ledger.error.unbalanced": "Debit/Credit totals are not balanced.",
    "ledger.error.unknown": "An error occurred while processing your request.",
    "ledger.meta.kind.ORIGINAL": "Original",
    "ledger.meta.kind.CORRECTION": "Correction",
    "ledger.meta.kind.REVERSAL": "Reversal",

    "quickAdd.title": "Quick Add",
    "quickAdd.button.close": "Close",
    "quickAdd.button.paste": "Paste",
    "quickAdd.button.parse": "Parse",
    "quickAdd.button.apply": "Apply to Form",
    "quickAdd.notice.manualTrigger":
      "Parsing runs only on explicit action. Clipboard is never read automatically on app load.",
    "quickAdd.notice.pasteLoaded": "Clipboard loaded. Click Parse to analyze.",
    "quickAdd.notice.pasteFailed": "Clipboard access failed. Please paste manually.",
    "quickAdd.notice.partial": "Some fields were not auto-filled. Check guidance below.",
    "quickAdd.notice.ready": "Parsing complete. You can apply the result to the form.",
    "quickAdd.label.inputText": "Raw text input",
    "quickAdd.placeholder.inputText": "e.g. 2026-02-08 Starbucks KRW 12,900 card approval",
    "quickAdd.label.confidence": "Confidence",
    "quickAdd.label.occurredAt": "Occurred at",
    "quickAdd.label.amount": "Amount",
    "quickAdd.label.memo": "Memo",
    "quickAdd.label.direction": "Direction",
    "quickAdd.label.reasonCodes": "Reason codes",

    "csv.title": "CSV Studio",
    "csv.title.export": "Export",
    "csv.title.importPipeline": "Import Pipeline",
    "csv.title.auditEvents": "Audit Events",
    "csv.title.transactionImport": "Simple Transaction CSV Import",
    "csv.button.loadCanonical": "Load Canonical",
    "csv.button.loadFlatBom": "Load Flat (BOM)",
    "csv.button.useCanonicalAsImport": "Use Canonical as Import Payload",
    "csv.button.preview": "Preview",
    "csv.button.commit": "Commit",
    "csv.button.refreshAudit": "Refresh Audit",
    "csv.button.transactionPreview": "Preview Simple CSV",
    "csv.button.applyTransactionImport": "Apply Simple CSV",
    "csv.label.canonicalFiles": "Canonical Bundle Files (JSON)",
    "csv.label.flatCsv": "Flat CSV",
    "csv.label.importPayload": "Import Payload (JSON array)",
    "csv.label.forceMode": "Force mode (allow commit even with preview errors)",
    "csv.label.transactionSchema": "Schema: accountName, date, description, amount, category(nullable)",
    "csv.label.transactionCsvInput": "Simple CSV Input",
    "csv.label.applyPolicy": "Apply Policy",
    "csv.label.validRows": "Valid rows",
    "csv.label.errorRows": "Error rows",
    "csv.label.totalIncome": "Total income",
    "csv.label.totalExpense": "Total expense",
    "csv.label.net": "Net",
    "csv.label.session": "Session",
    "csv.label.status": "Status",
    "csv.label.rows": "Rows",
    "csv.label.errors": "Errors",
    "csv.policy.failOnAnyError": "Fail on any error (block apply)",
    "csv.policy.allowPartial": "Allow partial (apply valid rows only)",
    "csv.status.none": "None",
    "csv.status.noPreview": "Run preview to view validation results.",
    "csv.status.noAudit": "No audit events yet.",
    "csv.status.noTransactionPreview": "Run simple CSV preview to view validation results.",
    "csv.notice.exportCanonicalLoaded": "Canonical export loaded.",
    "csv.notice.exportFlatLoaded": "Flat export loaded.",
    "csv.notice.canonicalCopied": "Canonical export copied to import payload.",
    "csv.notice.previewCompleted": "Preview completed.",
    "csv.notice.commitCompleted": "Import committed.",
    "csv.notice.auditLoaded": "Audit events loaded.",
    "csv.notice.transactionPreviewCompleted": "Simple CSV preview completed.",
    "csv.notice.transactionApplyBlocked": "Cannot apply with the selected policy due to errors.",
    "csv.notice.transactionApplied":
      "Applied: {count} rows, income {income} KRW, expense {expense} KRW",
    "csv.notice.invalidImportPayload": "Import payload must be a valid JSON array.",
    "csv.error.exportCanonicalFailed": "Canonical export failed: {code}",
    "csv.error.exportFlatFailed": "Flat export failed: {code}",
    "csv.error.previewFailed": "Preview failed: {code}",
    "csv.error.commitFailed": "Commit failed: {code}",
    "csv.error.auditFailed": "Failed to load audit events.",
    "csv.error.previewFirst": "Run preview first to get a session id.",
    "csv.error.message.error.csv.previewFailed": "CSV preview failed.",
    "csv.error.message.error.csv.commitFailed": "CSV commit failed.",
    "csv.error.message.error.csv.duplicateImport":
      "Duplicate import detected. Use force mode if intentional.",
    "csv.error.message.errors.csv.invalidDate": "Invalid date format.",
    "csv.error.message.errors.csv.invalidAmount": "Invalid amount format.",
    "csv.error.message.errors.csv.missingRequired": "Missing required fields.",
    "csv.error.message.errors.csv.unbalancedPostings": "Postings are unbalanced.",
    "csv.error.message.errors.csv.currencyMismatch": "Currency mismatch with base currency.",
    "csv.error.message.errors.csv.lockedTransaction": "Locked transaction cannot be imported.",

    "recurring.title": "Recurring Draft Generator",
    "recurring.title.createRule": "Create Rule",
    "recurring.title.run": "Run Due Generator",
    "recurring.title.rules": "Rules",
    "recurring.title.generated": "Generated Draft Instances",
    "recurring.label.template": "Template",
    "recurring.label.amount": "Amount (KRW)",
    "recurring.label.dayOfMonth": "Day of month",
    "recurring.label.startDate": "Start date",
    "recurring.label.memo": "Memo",
    "recurring.label.targetDate": "Target date",
    "recurring.button.createRule": "Create Rule",
    "recurring.button.generateDrafts": "Generate Drafts",
    "recurring.notice.loadFailed": "Failed to load recurring rules.",
    "recurring.notice.ruleCreated": "Recurring rule created.",
    "recurring.notice.runFailed": "Recurring run failed: {code}",
    "recurring.notice.generated": "Generated drafts: {count}",
    "recurring.status.noRules": "No rules yet.",
    "recurring.status.noGenerated": "Run generator to produce drafts.",

    "dashboard.title": "Dashboard",
    "dashboard.title.monthlySpendTrend": "Monthly Spend Trend",
    "dashboard.title.categoryBreakdown": "Category Breakdown",
    "dashboard.title.recurringUpcoming": "Recurring Upcoming Drafts",
    "dashboard.title.inputHealth": "Input Health",
    "dashboard.card.income": "Income",
    "dashboard.card.expense": "Expense",
    "dashboard.card.net": "Net",
    "dashboard.label.daysTracked": "Days tracked (30d)",
    "dashboard.label.quickAddRatio": "Quick Add ratio",
    "dashboard.label.csvImportSuccess": "CSV import success",
    "dashboard.notice.loading": "Loading dashboard...",
    "dashboard.notice.updated": "Dashboard updated.",
    "dashboard.notice.loadFailed": "Failed to load dashboard: {code}",
    "dashboard.status.noExpense": "No expense data yet.",
    "dashboard.status.noRecurring": "No recurring rules yet."
  }
};

export function uiMessage(locale: AppLocale, key: string, params?: MessageParams) {
  const template = MESSAGES[locale][key] ?? key;
  if (!params) {
    return template;
  }

  return template.replace(/\{([a-zA-Z0-9_]+)\}/g, (full, capture: string) => {
    const value = params[capture];
    return value === undefined ? full : String(value);
  });
}
